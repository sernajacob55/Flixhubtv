<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FlixHubTV - Browse</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Highlight active genre */
    .sidebar ul li {
      cursor: pointer;
      padding: 8px 15px;
      transition: all 0.3s ease;
    }
    .sidebar ul li:hover {
      background: rgba(0, 229, 255, 0.1);
    }
    .sidebar ul li.active {
      color: #00e5ff;
      font-weight: bold;
      text-shadow: 0 0 10px #00e5ff;
    }
    /* Slide animation for movies */
    .movie-card {
      opacity: 1;
      transform: translateY(0);
      transition: all 0.4s ease;
    }
    .movie-card.hide {
      opacity: 0;
      transform: translateY(30px);
      pointer-events: none;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <h2>Genres</h2>
    <ul id="genreList"></ul>
  </aside>

  <!-- Header -->
  <header>
    <h1><span>Flix</span>HubTV</h1>
    <div class="nav-actions">
      <input type="text" class="search-bar" placeholder="Search movies...">
      <button onclick="window.location.href='profiles.html'">Switch Profile</button>
      <button onclick="window.location.href='login.html'">Logout</button>
      <button onclick="window.location.href='index.html'">Home</button>
    </div>
  </header>

  <!-- Welcome -->
  <main>
    <div class="welcome-container" style="text-align:center; margin: 30px 0;">
      <h2 id="welcomeMessage" style="color:#00e5ff; text-shadow:0 0 10px #00e5ff;"></h2>
    </div>

    <!-- Watchlist -->
    <div id="watchlistBanner" class="banner" style="display:none;">
      <h2>Your Watchlist</h2>
      <div class="banner-items" id="watchlistItems"></div>
    </div>

    <!-- Continue Watching -->
    <div id="continueBanner" class="banner" style="display:none;">
      <h2>Continue Watching</h2>
      <div class="banner-items" id="continueItems"></div>
    </div>

    <!-- Movies -->
    <section class="movie-grid" id="moviesContainer"></section>
  </main>

  <!-- Scripts -->
  <script>
    const apiKey = "ea7569d7";
    const movies = [
      { id: "tt0133093" } // The Matrix
      // Add more movies here later...
    ];

    // Show profile welcome
    const activeProfile = localStorage.getItem("activeProfile");
    document.getElementById("welcomeMessage").textContent =
      activeProfile ? `Welcome, ${activeProfile}` : "Welcome to FlixHubTV";

    // Load Watchlist
    const watchlist = JSON.parse(localStorage.getItem("watchlist")) || [];
    if (watchlist.length > 0) {
      document.getElementById("watchlistBanner").style.display = "block";
      watchlist.forEach(movie => {
        const div = document.createElement("div");
        div.classList.add("banner-item");
        div.innerHTML = `<img src="${movie.poster}" alt="${movie.title}"><p>${movie.title}</p>`;
        document.getElementById("watchlistItems").appendChild(div);
      });
    }

    // Load Continue Watching
    const continueWatching = JSON.parse(localStorage.getItem("continueWatching")) || [];
    if (continueWatching.length > 0) {
      document.getElementById("continueBanner").style.display = "block";
      continueWatching.forEach(movie => {
        const div = document.createElement("div");
        div.classList.add("banner-item");
        div.innerHTML = `<img src="${movie.poster}" alt="${movie.title}"><p>${movie.title}</p>`;
        document.getElementById("continueItems").appendChild(div);
      });
    }

    // Fetch Movies and Build Dynamic Sidebar Genres
    const genreSet = new Set();
    const moviesContainer = document.getElementById("moviesContainer");

    async function fetchMovies() {
      for (let movie of movies) {
        const response = await fetch(`https://www.omdbapi.com/?i=${movie.id}&apikey=${apiKey}`);
        const data = await response.json();
        if (data.Response === "True") {
          // Movie card
          const card = document.createElement("div");
          card.classList.add("movie-card");
          card.setAttribute("data-genres", data.Genre);
          card.innerHTML = `
            <img src="${data.Poster}" alt="${data.Title}">
            <h3>${data.Title}</h3>
          `;
          card.onclick = () => {
            window.location.href = `movie.html?id=${movie.id}`;
          };
          moviesContainer.appendChild(card);

          // Collect genres across all movies
          data.Genre.split(", ").forEach(g => genreSet.add(g));
        }
      }

      // Populate Sidebar Genres dynamically
      const genreList = document.getElementById("genreList");
      genreList.innerHTML = ""; // clear first
      const allOption = document.createElement("li");
      allOption.textContent = "All";
      allOption.classList.add("active");
      allOption.onclick = () => setActiveGenre(allOption, "All");
      genreList.appendChild(allOption);

      genreSet.forEach(genre => {
        const li = document.createElement("li");
        li.textContent = genre;
        li.onclick = () => setActiveGenre(li, genre);
        genreList.appendChild(li);
      });

      // Apply saved genre from movie.html if exists
      const savedGenre = localStorage.getItem("selectedGenre");
      if (savedGenre) {
        const li = [...document.querySelectorAll("#genreList li")].find(el => el.textContent === savedGenre);
        if (li) setActiveGenre(li, savedGenre);
        localStorage.removeItem("selectedGenre"); // clear after use
      }
    }

    fetchMovies();

    // Genre filtering
    function setActiveGenre(selectedElement, genre) {
      document.querySelectorAll(".sidebar ul li").forEach(li => li.classList.remove("active"));
      selectedElement.classList.add("active");
      filterMovies(genre);
    }

    function filterMovies(genre) {
      document.querySelectorAll(".movie-card").forEach(card => {
        const genres = card.getAttribute("data-genres");
        if (genre === "All" || genres.includes(genre)) {
          card.classList.remove("hide");
        } else {
          card.classList.add("hide");
        }
      });
    }

    // Search handler
    document.querySelector(".search-bar").addEventListener("keypress", function (e) {
      if (e.key === "Enter") {
        alert("Search feature coming soon: " + this.value);
      }
    });
  </script>
</body>
</html>