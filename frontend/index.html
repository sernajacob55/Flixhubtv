<script>
  async function loadMovies() {
    const res = await fetch("/api/movies");
    const categories = await res.json();
    const container = document.getElementById("categories");
    container.innerHTML = "";

    categories.forEach(category => {
      if (!category.movies || category.movies.length === 0) {
        return; // Skip empty categories
      }

      const section = document.createElement("div");
      section.className = "category";

      const heading = document.createElement("h2");
      heading.textContent = category.name;
      section.appendChild(heading);

      const row = document.createElement("div");
      row.className = "row";

      category.movies.forEach(movie => {
        const tile = document.createElement("div");
        tile.className = "movie-tile";

        const img = document.createElement("img");
        img.src = movie.cover;
        img.alt = movie.title;

        const title = document.createElement("div");
        title.className = "movie-title";
        title.textContent = movie.title;

        tile.onclick = async () => {
          const overlay = document.getElementById("videoOverlay");
          const player = document.getElementById("player");

          player.src = movie.url;
          overlay.style.display = "flex";

          try {
            await player.play();
            if (player.requestFullscreen) {
              player.requestFullscreen();
            } else if (player.webkitRequestFullscreen) {
              player.webkitRequestFullscreen();
            } else if (player.msRequestFullscreen) {
              player.msRequestFullscreen();
            }
          } catch (err) {
            console.log("Autoplay blocked:", err);
          }
        };

        tile.appendChild(img);
        tile.appendChild(title);
        row.appendChild(tile);
      });

      section.appendChild(row);
      container.appendChild(section);
    });
  }

  // Close button functionality
  document.getElementById("closeBtn").onclick = () => {
    const overlay = document.getElementById("videoOverlay");
    const player = document.getElementById("player");
    player.pause();
    overlay.style.display = "none";
  };

  loadMovies();
</script>