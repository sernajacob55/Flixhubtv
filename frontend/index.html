<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FlixHubTV - Browse</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Genre Highlight */
    .sidebar ul li {
      cursor: pointer;
      padding: 8px 15px;
      transition: all 0.3s ease;
    }

    .sidebar ul li:hover {
      background: rgba(0, 229, 255, 0.1);
    }

    .sidebar ul li.active {
      color: #00e5ff;
      font-weight: bold;
      text-shadow: 0 0 10px #00e5ff;
    }

    /* Movie card slide animation */
    .movie-card {
      opacity: 1;
      transform: translateY(0);
      transition: all 0.4s ease;
    }

    .movie-card.hide {
      opacity: 0;
      transform: translateY(30px);
      pointer-events: none;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <h3>Genres</h3>
    <ul id="genreList"></ul>
  </div>

  <!-- Navbar -->
  <div class="navbar">
    <div class="logo">Flix<span>HubTV</span></div>
    <div class="nav-actions">
      <input type="text" class="search-bar" placeholder="Search movies..." />
      <button onclick="window.location.href='profiles.html'" class="nav-btn">Switch Profile</button>
      <button onclick="window.location.href='login.html'" class="nav-btn">Logout</button>
      <button onclick="window.location.href='index.html'" class="nav-btn">Home</button>
    </div>
  </div>

  <!-- Welcome Section -->
  <div class="welcome-container" style="text-align:center; margin: 30px 0;">
    <h2 id="welcomeMessage" style="color:#00e5ff; text-shadow:0 0 10px #00e5ff;"></h2>
  </div>

  <!-- Watchlist Banner -->
  <div id="watchlistBanner" class="banner" style="display:none;">
    <h2>Your Watchlist</h2>
    <div class="banner-items" id="watchlistItems"></div>
  </div>

  <!-- Continue Watching Banner -->
  <div id="continueBanner" class="banner" style="display:none;">
    <h2>Continue Watching</h2>
    <div class="banner-items" id="continueItems"></div>
  </div>

  <!-- Movies Section -->
  <div class="movies-container" id="moviesContainer"></div>

  <script>
    const apiKey = "ea7569d7";
    const movies = [
      { id: "tt0133093" } // The Matrix
    ];

    // Active profile greeting
    const activeProfile = localStorage.getItem("activeProfile");
    const welcomeMessage = document.getElementById("welcomeMessage");
    if (activeProfile) {
      welcomeMessage.textContent = `Welcome, ${activeProfile}`;
    } else {
      welcomeMessage.textContent = "Welcome to FlixHubTV";
    }

    // Load Watchlist
    const watchlist = JSON.parse(localStorage.getItem("watchlist")) || [];
    const watchlistBanner = document.getElementById("watchlistBanner");
    const watchlistItems = document.getElementById("watchlistItems");

    if (watchlist.length > 0) {
      watchlistBanner.style.display = "block";
      watchlist.forEach(movie => {
        const div = document.createElement("div");
        div.classList.add("banner-item");
        div.innerHTML = `<img src="${movie.poster}" alt="${movie.title}" /><p>${movie.title}</p>`;
        watchlistItems.appendChild(div);
      });
    }

    // Load Continue Watching
    const continueWatching = JSON.parse(localStorage.getItem("continueWatching")) || [];
    const continueBanner = document.getElementById("continueBanner");
    const continueItems = document.getElementById("continueItems");

    if (continueWatching.length > 0) {
      continueBanner.style.display = "block";
      continueWatching.forEach(movie => {
        const div = document.createElement("div");
        div.classList.add("banner-item");
        div.innerHTML = `<img src="${movie.poster}" alt="${movie.title}" /><p>${movie.title}</p>`;
        continueItems.appendChild(div);
      });
    }

    // Fetch Movies and Build Dynamic Genres
    const genreSet = new Set();
    const moviesContainer = document.getElementById("moviesContainer");

    async function fetchMovies() {
      for (let movie of movies) {
        const response = await fetch(`https://www.omdbapi.com/?i=${movie.id}&apikey=${apiKey}`);
        const data = await response.json();
        if (data.Response === "True") {
          // Movie card
          const card = document.createElement("div");
          card.classList.add("movie-card");
          card.setAttribute("data-genres", data.Genre);
          card.innerHTML = `
            <img src="${data.Poster}" alt="${data.Title}" />
            <h3>${data.Title}</h3>
          `;
          card.onclick = () => {
            window.location.href = `movie.html?id=${movie.id}`;
          };
          moviesContainer.appendChild(card);

          // Collect genres
          data.Genre.split(", ").forEach(g => genreSet.add(g));
        }
      }

      // Populate Sidebar Genres
      const genreList = document.getElementById("genreList");
      const allOption = document.createElement("li");
      allOption.textContent = "All";
      allOption.classList.add("active"); // default highlight
      allOption.onclick = () => setActiveGenre(allOption, "All");
      genreList.appendChild(allOption);

      genreSet.forEach(genre => {
        const li = document.createElement("li");
        li.textContent = genre;
        li.onclick = () => setActiveGenre(li, genre);
        genreList.appendChild(li);
      });
    }

    fetchMovies();

    // Handle active genre + filtering with slide animation
    function setActiveGenre(selectedElement, genre) {
      // Remove active class from all
      document.querySelectorAll(".sidebar ul li").forEach(li => li.classList.remove("active"));

      // Add active to selected
      selectedElement.classList.add("active");

      // Filter movies
      filterMovies(genre);
    }

    function filterMovies(genre) {
      const cards = document.querySelectorAll(".movie-card");
      cards.forEach(card => {
        const genres = card.getAttribute("data-genres");
        if (genre === "All" || genres.includes(genre)) {
          card.classList.remove("hide");
        } else {
          card.classList.add("hide");
        }
      });
    }

    // Search handler
    const searchBar = document.querySelector(".search-bar");
    searchBar.addEventListener("keypress", function (e) {
      if (e.key === "Enter") {
        alert("Search feature coming soon: " + searchBar.value);
      }
    });
  </script>
</body>
</html>