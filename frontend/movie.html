<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Movie • FlixHubTV</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Header -->
  <header>
    <h1>Flix<span>HubTV</span></h1>
    <div class="nav-buttons">
      <button onclick="location.href='index.html'">Home</button>
      <button onclick="location.href='profiles.html'">Switch Profile</button>
      <button onclick="location.href='login.html'">Logout</button>
    </div>
  </header>

  <!-- Page wrapper -->
  <div class="page">
    <!-- Sidebar -->
    <aside class="sidebar" id="leftSidebar" aria-label="Genres">
      <h3>Genres</h3>
      <ul>
        <li data-filter="all">All</li>
        <li data-filter="Action">Action</li>
        <li data-filter="Sci-Fi">Sci-Fi</li>
      </ul>
    </aside>

    <!-- Main content -->
    <main class="main-content" id="movieContent">
      <section id="movieDetails">
        <img id="moviePoster" alt="Movie Poster"/>
        <div>
          <h2 id="movieTitle"></h2>
          <p><strong>Genre:</strong> <span id="movieGenre"></span></p>
          <p><strong>Runtime:</strong> <span id="movieRuntime"></span></p>
          <p id="moviePlot"></p>

          <button id="watchlistBtn">+ Add to Watchlist</button>
          <button id="playBtn">▶ Play</button>
        </div>
      </section>

      <!-- Cast -->
      <section id="castSection">
        <h3>Cast</h3>
        <div id="castGrid"></div>
      </section>

      <!-- Recommended Movies -->
      <section id="recommendations">
        <h3>Recommended</h3>
        <div id="recommendGrid"></div>
      </section>
    </main>
  </div>

  <!-- Footer -->
  <footer>
    © 2025 FlixHubTV. All rights reserved.
  </footer>

  <!-- Fullscreen Player -->
  <div id="videoPlayer" class="fullscreen" style="display: none;">
    <button id="exitFullscreen" class="exit-fullscreen">X</button>
    <video id="movieVideo" controls autoplay></video>
  </div>

  <script>
    /**************
     * API KEYS
     **************/
    const OMDB_KEY = "ea7569d7"; // OMDb
    const TMDB_KEY = "a2942c822ee97bc0df2dba1a65cf2d0f"; // TMDb

    /**************
     * URL PARAMS
     **************/
    const urlParams = new URLSearchParams(window.location.search);
    const imdbID = urlParams.get("id");

    /**************
     * Sidebar Hover
     **************/
    (function setupSidebarShift() {
      const sidebar = document.getElementById('leftSidebar');
      if (!sidebar) return;
      sidebar.addEventListener('mouseenter', () => {
        document.body.classList.add('sidebar-open');
      });
      sidebar.addEventListener('mouseleave', () => {
        document.body.classList.remove('sidebar-open');
      });
    })();

    /**************
     * Load Movie Metadata (OMDb)
     **************/
    async function loadMovieDetails() {
      if (!imdbID) return;

      const res = await fetch(`https://www.omdbapi.com/?i=${imdbID}&apikey=${OMDB_KEY}`);
      const data = await res.json();

      document.getElementById("moviePoster").src = data.Poster !== "N/A" ? data.Poster : "placeholder.jpg";
      document.getElementById("movieTitle").textContent = `${data.Title} (${data.Year})`;
      document.getElementById("movieGenre").textContent = data.Genre;
      document.getElementById("movieRuntime").textContent = data.Runtime;
      document.getElementById("moviePlot").textContent = data.Plot;
    }

    /**************
     * Load Cast (TMDb)
     **************/
    async function loadCast() {
      if (!imdbID) return;

      const tmdbRes = await fetch(`https://api.themoviedb.org/3/find/${imdbID}?api_key=${TMDB_KEY}&external_source=imdb_id`);
      const tmdbData = await tmdbRes.json();
      if (!tmdbData.movie_results.length) return;

      const movieId = tmdbData.movie_results[0].id;
      const creditsRes = await fetch(`https://api.themoviedb.org/3/movie/${movieId}/credits?api_key=${TMDB_KEY}`);
      const creditsData = await creditsRes.json();

      const castGrid = document.getElementById("castGrid");
      creditsData.cast.slice(0, 6).forEach(actor => {
        const div = document.createElement("div");
        div.className = "actor-card";
        div.innerHTML = `
          <img src="https://image.tmdb.org/t/p/w200${actor.profile_path}" alt="${actor.name}" />
          <p>${actor.name}</p>
        `;
        castGrid.appendChild(div);
      });
    }

    /**************
     * Load Recommendations (TMDb)
     **************/
    async function loadRecommendations() {
      if (!imdbID) return;

      const tmdbRes = await fetch(`https://api.themoviedb.org/3/find/${imdbID}?api_key=${TMDB_KEY}&external_source=imdb_id`);
      const tmdbData = await tmdbRes.json();
      if (!tmdbData.movie_results.length) return;

      const movieId = tmdbData.movie_results[0].id;
      const recRes = await fetch(`https://api.themoviedb.org/3/movie/${movieId}/recommendations?api_key=${TMDB_KEY}`);
      const recData = await recRes.json();

      const recGrid = document.getElementById("recommendGrid");
      recData.results.slice(0, 6).forEach(rec => {
        const div = document.createElement("div");
        div.className = "movie-card";
        div.innerHTML = `
          <a href="movie.html?id=${rec.id}">
            <img src="https://image.tmdb.org/t/p/w200${rec.poster_path}" alt="${rec.title}" />
            <h3>${rec.title}</h3>
          </a>
        `;
        recGrid.appendChild(div);
      });
    }

    /**************
     * Watchlist
     **************/
    const watchlistBtn = document.getElementById("watchlistBtn");
    watchlistBtn.addEventListener("click", () => {
      watchlistBtn.textContent = watchlistBtn.textContent.includes("Add")
        ? "✓ Added to Watchlist"
        : "+ Add to Watchlist";
    });

    /**************
     * Fullscreen Player
     **************/
    document.getElementById("playBtn").addEventListener("click", () => {
      const player = document.getElementById("videoPlayer");
      const video = document.getElementById("movieVideo");
      video.src = imdbID === "tt0133093"
        ? "https://download1324.mediafire.com/.../TheMatrix.mp4"
        : "https://download1324.mediafire.com/.../DantesPeak.mp4";
      player.style.display = "block";
      video.play();
    });

    document.getElementById("exitFullscreen").addEventListener("click", () => {
      document.getElementById("videoPlayer").style.display = "none";
      document.getElementById("movieVideo").pause();
    });

    /**************
     * Init
     **************/
    loadMovieDetails();
    loadCast();
    loadRecommendations();
  </script>
</body>
</html>