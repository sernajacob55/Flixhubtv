<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Movie • FlixHubTV</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Header -->
  <header>
    <h1>Flix<span>HubTV</span></h1>
    <div class="nav-buttons">
      <button onclick="location.href='index.html'">Home</button>
      <button onclick="location.href='profiles.html'">Switch Profile</button>
      <button onclick="location.href='login.html'">Logout</button>
    </div>
  </header>

  <!-- Page wrapper -->
  <div class="page">
    <!-- Sidebar -->
    <aside class="sidebar" id="leftSidebar" aria-label="Genres">
      <h3>Genres</h3>
      <ul>
        <li data-filter="all">All</li>
        <li data-filter="Action">Action</li>
        <li data-filter="Sci-Fi">Sci-Fi</li>
      </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="movieContent">
      <!-- Movie Metadata -->
      <section id="movieDetails" class="movie-details">
        <img id="moviePoster" alt="Movie Poster"/>
        <div>
          <h2 id="movieTitle"></h2>
          <p><strong>Genre:</strong> <span id="movieGenre"></span></p>
          <p><strong>Runtime:</strong> <span id="movieRuntime"></span></p>
          <p id="moviePlot"></p>

          <button id="watchlistBtn" class="action-btn">+ Add to Watchlist</button>
          <button id="playBtn" class="action-btn">▶ Play</button>
        </div>
      </section>

      <!-- Cast Section -->
      <section id="castSection">
        <h3>Cast</h3>
        <div id="castGrid"></div>
      </section>

      <!-- Recommended Movies -->
      <section id="recommendations">
        <h3>Recommended</h3>
        <div id="recommendGrid"></div>
      </section>
    </main>
  </div>

  <!-- Footer -->
  <footer>
    © 2025 FlixHubTV. All rights reserved.
  </footer>

  <!-- Fullscreen Player -->
  <div id="videoPlayer" class="video-player" style="display:none;">
    <button id="exitFullscreen" class="close-btn">X</button>
    <video id="movieVideo" controls autoplay></video>
  </div>

  <script>
    const OMDB_KEY = "ea7569d7"; 
    const TMDB_KEY = "a2942c822ee97bc0df2dba1a65cf2d0f";

    const urlParams = new URLSearchParams(window.location.search);
    const imdbID = urlParams.get("id");

    // Sidebar hover
    const sidebar = document.getElementById('leftSidebar');
    sidebar.addEventListener('mouseenter', () => document.body.classList.add('sidebar-open'));
    sidebar.addEventListener('mouseleave', () => document.body.classList.remove('sidebar-open'));

    // Load metadata
    async function loadMovieDetails() {
      const res = await fetch(`https://www.omdbapi.com/?i=${imdbID}&apikey=${OMDB_KEY}`);
      const data = await res.json();
      document.getElementById("moviePoster").src = data.Poster !== "N/A" ? data.Poster : "placeholder.jpg";
      document.getElementById("movieTitle").textContent = `${data.Title} (${data.Year})`;
      document.getElementById("movieGenre").textContent = data.Genre;
      document.getElementById("movieRuntime").textContent = data.Runtime;
      document.getElementById("moviePlot").textContent = data.Plot;
    }

    // Load cast
    async function loadCast() {
      const tmdbRes = await fetch(`https://api.themoviedb.org/3/find/${imdbID}?api_key=${TMDB_KEY}&external_source=imdb_id`);
      const tmdbData = await tmdbRes.json();
      if(!tmdbData.movie_results.length) return;
      const movieId = tmdbData.movie_results[0].id;
      const creditsRes = await fetch(`https://api.themoviedb.org/3/movie/${movieId}/credits?api_key=${TMDB_KEY}`);
      const creditsData = await creditsRes.json();
      const castGrid = document.getElementById("castGrid");
      castGrid.innerHTML = "";
      creditsData.cast.slice(0,6).forEach(actor => {
        const div = document.createElement("div");
        div.className = "actor-card";
        div.innerHTML = `
          <img src="${actor.profile_path ? 'https://image.tmdb.org/t/p/w200'+actor.profile_path : 'placeholder.jpg'}" alt="${actor.name}" />
          <p>${actor.name}</p>
        `;
        castGrid.appendChild(div);
      });
    }

    // Load recommendations
    async function loadRecommendations() {
      const tmdbRes = await fetch(`https://api.themoviedb.org/3/find/${imdbID}?api_key=${TMDB_KEY}&external_source=imdb_id`);
      const tmdbData = await tmdbRes.json();
      if(!tmdbData.movie_results.length) return;
      const movieId = tmdbData.movie_results[0].id;
      const recRes = await fetch(`https://api.themoviedb.org/3/movie/${movieId}/recommendations?api_key=${TMDB_KEY}`);
      const recData = await recRes.json();
      const recGrid = document.getElementById("recommendGrid");
      recGrid.innerHTML = "";
      recData.results.slice(0,6).forEach(rec => {
        const div = document.createElement("div");
        div.className = "movie-card";
        div.innerHTML = `
          <a href="movie.html?id=${rec.id}">
            <img src="${rec.poster_path ? 'https://image.tmdb.org/t/p/w200'+rec.poster_path : 'placeholder.jpg'}" alt="${rec.title}" />
            <h3>${rec.title}</h3>
          </a>
        `;
        recGrid.appendChild(div);
      });
    }

    // Watchlist button
    const watchlistBtn = document.getElementById("watchlistBtn");
    watchlistBtn.addEventListener("click", () => {
      let watchlist = JSON.parse(localStorage.getItem("watchlist")) || [];
      if (watchlist.includes(imdbID)) {
        watchlist = watchlist.filter(id => id !== imdbID);
        watchlistBtn.textContent = "+ Add to Watchlist";
      } else {
        watchlist.push(imdbID);
        watchlistBtn.textContent = "✓ Added";
      }
      localStorage.setItem("watchlist", JSON.stringify(watchlist));
    });

    // Play button
    const playBtn = document.getElementById("playBtn");
    playBtn.addEventListener("click", () => {
      const player = document.getElementById("videoPlayer");
      const video = document.getElementById("movieVideo");

      // MediaFire links for known movies
      let movieSrc = "";
      if (imdbID === "tt0133093") { // The Matrix
        movieSrc = "https://download1351.mediafire.com/moph99vymelgB4tgVyH9-EiWi8-NqEibljxmsFvx7MJGEr6mF6KBkWiSUCA99-DhpkeeA1m42myFlnxm20g63-4yxCtqulAo-babZQt1Nu68RQGklpbZcsAnQlBFgd8Qfgto6AOQrxZ7DqkDJ0Mw0RDXGlcCFra4ZLOqktfQiw2sbJY/rks796idw5xqo2i/The+Matrix.mp4";
      } else if (imdbID === "tt0118928") { // Dante's Peak
        movieSrc = "https://download1324.mediafire.com/cd5ev8gxoajggy5dbp_1pagixal-14NXp2krW0s3WdxiRxacbt_tmKEN5wBSXGhBxaHmQRL6a_oqit-_4Uqm6r7Th8gd02jAsy_iWXSiGUZejYG1i7-rTMQrhWr5Q8OQan-9adl7oEEEJK7mmWiPIvTIT_iyRk3hboxiQfNDUHmnI0Q/jtd07wddlls76o2/Dantes+Peak.mp4";
      }

      if (movieSrc) {
        video.src = movieSrc;
        player.style.display = "flex";
        video.play();
      }
    });

    // Exit fullscreen
    const exitBtn = document.getElementById("exitFullscreen");
    exitBtn.addEventListener("click", () => {
      const player = document.getElementById("videoPlayer");
      const video = document.getElementById("movieVideo");
      video.pause();
      video.src = "";
      player.style.display = "none";
    });

    // Init
    loadMovieDetails();
    loadCast();
    loadRecommendations();
  </script>
</body>
</html>