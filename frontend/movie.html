<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Movie Info • FlixHubTV</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Header / Navbar -->
  <header>
    <h1><span class="flix">FLIX</span><span class="hub">HubTV</span></h1>

    <div class="nav-buttons">
      <button id="menuToggle">☰</button>
      <input id="searchInput" type="text" placeholder="Search movies..." aria-label="Search movies"/>
      <button id="switchProfileBtn" onclick="location.href='profiles.html'">Switch Profile</button>
      <button id="logoutBtn" onclick="location.href='login.html'">Logout</button>
      <button id="homeBtn" onclick="location.href='index.html'">Home</button>
    </div>
  </header>

  <!-- Page wrapper -->
  <div class="page">
    <!-- Sidebar -->
    <aside class="sidebar" id="leftSidebar" aria-label="Genres">
      <h3>Genres</h3>
      <ul></ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="content">
      <div class="welcome" id="welcomeText">Welcome, Serna</div>

      <!-- ✅ Movie Info Section -->
      <section id="movieInfo"></section>

      <!-- Continue Watching -->
      <section class="continue-watching">
        <h2>Continue Watching</h2>
        <div id="continueWatchingList" class="movie-grid"></div>
      </section>

      <!-- Watchlist -->
      <section class="watchlist">
        <h2>My Watchlist</h2>
        <div id="watchlistGrid"></div>
      </section>
    </main>
  </div>

  <!-- Footer -->
  <footer>
    <p>© 2025 FlixHubTV. All rights reserved.</p>
  </footer>

  <!-- ✅ Shared Fullscreen Player -->
  <div id="videoPlayer" class="video-player" style="display:none;">
    <button id="exitFullscreen" class="close-btn">X</button>
    <video id="movieVideo" controls autoplay></video>
  </div>

  <!-- ✅ Scripts -->
  <script src="movies.js"></script>
  <script src="player.js"></script>

  <script>
    const OMDB_KEY = "ea7569d7";

    // Sidebar Toggle
    document.getElementById("menuToggle").addEventListener("click", () => {
      document.body.classList.toggle("sidebar-open");
    });

    // Load selected movie info
    async function loadMovieInfo() {
      const params = new URLSearchParams(window.location.search);
      const imdbID = params.get("id");
      if (!imdbID || !window.movieMap[imdbID]) {
        document.getElementById("movieInfo").innerHTML = "<p>Movie not found.</p>";
        return;
      }

      let data = {};
      try {
        const res = await fetch(`https://www.omdbapi.com/?i=${imdbID}&apikey=${OMDB_KEY}`);
        data = await res.json();
      } catch (err) {
        console.warn("OMDb fetch failed, using fallback", err);
      }

      const title = data.Title || "Unknown Title";
      const year = data.Year || "";
      const runtime = data.Runtime || "";
      const genre = data.Genre || "";
      const plot = data.Plot || "Plot not available.";
      const poster = (data.Poster && data.Poster !== "N/A") ? data.Poster : "placeholder.jpg";

      // ✅ Save current movie context for resume
      localStorage.setItem("currentMovieData", JSON.stringify({ imdbID, title, poster }));

      const infoDiv = document.getElementById("movieInfo");
      infoDiv.innerHTML = `
        <div class="movie-detail">
          <img src="${poster}" alt="Poster for ${title}" class="movie-detail-poster"/>
          <div class="movie-detail-text">
            <h2>${title}</h2>
            <p><strong>Year:</strong> ${year}</p>
            <p><strong>Runtime:</strong> ${runtime}</p>
            <p><strong>Genre:</strong> ${genre}</p>
            <p><strong>Plot:</strong> ${plot}</p>
            <button id="playBtn" class="action-btn">▶ Play</button>
          </div>
        </div>
      `;

      // ✅ Play button
      document.getElementById("playBtn").addEventListener("click", () => {
        const videoPlayer = document.getElementById("videoPlayer");
        const video = document.getElementById("movieVideo");
        video.src = window.movieMap[imdbID];
        video.load();
        videoPlayer.style.display = "flex";
        video.play().catch(() => {});
      });
    }

    // Reuse your existing helpers
    function setupWatchlist() { /* same as index.html */ }
    function setupContinueWatching() { /* same as index.html */ }

    // Init
    loadMovieInfo();
    setupContinueWatching();
    setupWatchlist();
  </script>
</body>
</html>