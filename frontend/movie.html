<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Movie • FlixHubTV</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Header -->
  <header>
    <h1><span class="logo-flix">Flix</span>HubTV</h1>
    <div class="nav-buttons">
      <button onclick="location.href='index.html'">Home</button>
      <button onclick="logout()">Logout</button>
    </div>
  </header>

  <!-- Movie Container -->
  <main id="movieDetails" class="main-content"></main>

  <!-- Video Player -->
  <div id="videoPlayer" class="video-container hidden">
    <div id="fullscreenWrapper">
      <video id="flixVideo" controls></video>
      <button id="closePlayer">X</button>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    /**************
     * API KEYS   *
     **************/
    const OMDB_KEY = "ea7569d7"; // OMDb

    /*********************
     * MOVIE SOURCES     *
     *********************/
    const movieSources = {
      "tt0133093": "https://download1351.mediafire.com/moph99vymelgB4tgVyH9-EiWi8-NqEibljxmsFvx7MJGEr6mF6KBkWiSUCA99-DhpkeeA1m42myFlnxm20g63-4yxCtqulAo-babZQt1Nu68RQGklpbZcsAnQlBFgd8Qfgto6AOQrxZ7DqkDJ0Mw0RDXGlcCFra4ZLOqktfQiw2sbJY/rks796idw5xqo2i/The+Matrix.mp4",
      "tt0118928": "https://download1324.mediafire.com/cd5ev8gxoajggy5dbp_1pagixal-14NXp2krW0s3WdxiRxacbt_tmKEN5wBSXGhBxaHmQRL6a_oqit-_4Uqm6r7Th8gd02jAsy_iWXSiGUZejYG1i7-rTMQrhWr5Q8OQan-9adl7oEEEJK7mmWiPIvTIT_iyRk3hboxiQfNDUHmnI0Q/jtd07wddlls76o2/Dantes+Peak.mp4"
    };

    /*********************
     * AUTH CHECK        *
     *********************/
    if (!localStorage.getItem("loggedIn")) {
      window.location.href = "login.html";
    }

    /*********************
     * LOGOUT FUNCTION   *
     *********************/
    function logout() {
      localStorage.removeItem("loggedIn");
      window.location.href = "login.html";
    }

    /*********************
     * GET MOVIE ID      *
     *********************/
    const urlParams = new URLSearchParams(window.location.search);
    const imdbID = urlParams.get("id");

    /*********************
     * LOAD METADATA     *
     *********************/
    fetch(`https://www.omdbapi.com/?i=${imdbID}&apikey=${OMDB_KEY}`)
      .then(r => r.json())
      .then(data => {
        if (!data || data.Response === "False") return;
        document.title = `${data.Title} • FlixHubTV`;
        document.getElementById("movieDetails").innerHTML = `
          <div class="movie-details">
            <img src="${data.Poster}" alt="${data.Title}" />
            <div class="movie-info">
              <h1>${data.Title}</h1>
              <p><strong>Released:</strong> ${data.Released}</p>
              <p><strong>Genre:</strong> ${data.Genre}</p>
              <p><strong>Actors:</strong> ${data.Actors}</p>
              <p>${data.Plot}</p>
              <div class="buttons">
                <button onclick="playMovie('${imdbID}')">▶ Play</button>
                <button onclick="toggleWatchlist('${imdbID}')">+ Watchlist</button>
              </div>
            </div>
          </div>
        `;
      });

    /*********************
     * PLAY MOVIE        *
     *********************/
    function playMovie(id) {
      const player = document.getElementById("videoPlayer");
      const video = document.getElementById("flixVideo");
      const source = movieSources[id];
      if (!source) return alert("Movie source not available");
      video.src = source;
      player.classList.remove("hidden");
      video.play();
      if (video.requestFullscreen) {
        video.requestFullscreen();
      } else if (video.webkitRequestFullscreen) {
        video.webkitRequestFullscreen();
      } else if (video.msRequestFullscreen) {
        video.msRequestFullscreen();
      }
    }

    /*********************
     * CLOSE PLAYER      *
     *********************/
    document.getElementById("closePlayer").addEventListener("click", () => {
      const player = document.getElementById("videoPlayer");
      const video = document.getElementById("flixVideo");
      video.pause();
      video.src = "";
      player.classList.add("hidden");
    });

    /*********************
     * WATCHLIST TOGGLE  *
     *********************/
    function toggleWatchlist(id) {
      const profile = localStorage.getItem("activeProfile") || "Guest";
      let watchlist = JSON.parse(localStorage.getItem("watchlist_" + profile) || "[]");
      if (watchlist.includes(id)) {
        watchlist = watchlist.filter(m => m !== id);
      } else {
        watchlist.push(id);
      }
      localStorage.setItem("watchlist_" + profile, JSON.stringify(watchlist));
      alert("Watchlist updated!");
    }
  </script>
</body>
</html>